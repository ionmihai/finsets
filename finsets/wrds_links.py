# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs/wrds_links.ipynb.

# %% ../nbs/wrds_links.ipynb 2
from __future__ import annotations
from typing import List, Dict, Tuple, Callable
import os

import pandas as pd
import numpy as np
import wrds 

from . import wrds_utils

# %% auto 0
__all__ = ['crspm_w_gvkey']

# %% ../nbs/wrds_links.ipynb 5
def crspm_w_gvkey(wrds_username: str=None) -> pd.DataFrame:
    """CRSP Monthly ids, with gvkeys"""

    sql_string="""SELECT a.date, a.permno, a.permco, c.gvkey, c.liid as iid
                  FROM crsp.msf a
                  INNER JOIN crsp.msenames b ON a.permno = b.permno
                                             AND a.date BETWEEN b.namedt AND b.nameendt 
                  INNER JOIN crsp.ccmxpf_lnkhist c ON a.permno = c.lpermno 
                                                   AND c.linktype IN ('LU','LC') AND c.linkprim IN ('P','C')
                                                   AND a.date BETWEEN c.linkdt AND COALESCE(c.linkenddt, CURRENT_DATE)
                """
    return wrds_utils.download(sql_string, wrds_username)
